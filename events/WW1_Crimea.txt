add_namespace = ww1_crimea

# UPRISING OF CRIMEA
####################
country_event = {
	id = ww1_crimea.1
	title = ww1_crimea.1.t
	desc = ww1_crimea.1.d
	picture = GFX_report_event_generic_military_parade
	is_triggered_only = yes
	trigger = {
		CRI = {
	 		exists = no
	 	}
	 	owns_state = 137
	}
	immediate = {
		hidden_effect = {
			137 = {
				every_country = {
					limit = {
						has_war_with = ROOT
						controls_state = PREV
					}
					CRI = { give_military_access = PREV }
				}
				transfer_state_to = CRI
			}
			RUS_matvei_sulkevich = {
				set_character_name = CRI_maciej_sulkiewicz
				set_nationality = CRI
			}
			CRI = {
				load_oob = "CRI_1918"
				set_popularities = {
					democratic = 29
					fascism = 0
					communism = 71
				}
				set_politics = {
					ruling_party = democratic
				}
				inherit_technology = RUS
			}
		}
	}
	option = {
		name = ww1_crimea.1.a
		effect_tooltip = {
			release = CRI
		}
	}
	option = {
		name = ww1_crimea.1.b
		CRI = {
			change_tag_from = ROOT
		}
		trigger = {
			is_ai = no
		}
	}
}

# SOVIET CRIMEA
################
country_event = {
	id = ww1_crimea.2
	title = ww1_crimea.2.t
	desc = ww1_crimea.2.d
	picture = GFX_report_event_generic_military_parade
	fire_only_once = yes
	is_triggered_only = yes
	option = {
		name = ww1_crimea.2.a
		add_to_faction = CRI
		CRI = {
			if = {
				limit = {
					has_character = CRI_noman_celebicihan
				}
				retire_character = CRI_noman_celebicihan
			}
		}
		hidden_effect = {
			CRI = { set_cosmetic_tag = SOV_puppet }
			if = {
				limit = {
					has_idea = RUS_idea_armistice_rus
				}
				CRI = { add_ideas = RUS_idea_armistice_rus }
			}
		}
	}
}

# Crimea Operation
country_event = {
	id = ww1_crimea.3
	title = ww1_crimea.3.t
	desc = ww1_crimea.3.desc
	picture = GFX_report_event_generic_peaceful_annexation
	fire_only_once = yes
	trigger = {
		tag = GER
		OR = {
			CRI = {
				OR = {
					is_neighbor_of = ROOT
					any_country = {
						is_neighbor_of = PREV
						is_subject_of = ROOT
					}
				}
				AND = {
					is_subject_of = SOV
					has_government = communism
				}
			}
			any_other_country = {
				OR = {
					is_neighbor_of = ROOT
					any_country = {
						is_neighbor_of = PREV
						is_subject_of = ROOT
					}
				}
				NOT = {
					is_in_faction_with = ROOT
					has_war_with = ROOT
					is_subject_of = ROOT
				}
				AND = {
					is_subject_of = SOV
					has_government = communism
				}
				controls_state = 137
			}
		}
		has_subject = UKR
		NOT = {
			has_war_with = SOV
			has_war_with = RUS
			has_country_flag = great_war_loser
			has_global_flag = compiegne_armistice
			has_government = communism
		}
	}
	mean_time_to_happen = {
		days = 20
	}
	option = {
		name = ww1_crimea.3.a
		effect_tooltip = { puppet = CRI }
		hidden_effect = {
			CRI = {
				# Bolshevik troops removal
				annex_country = {
					target = CRI
				}
				transfer_state = 137
				ROOT = {
					if = {
						limit = {
							has_subject_autonomy_feature = yes
						}
						set_autonomy = {
							target = PREV
							autonomous_state = autonomy_tgwr_informal_protectorate
						}
						PREV = { set_country_flag = protectorate }
						else = {
							puppet = PREV
							PREV = { add_ideas = protectorate }
						}
					}
				}
				set_cosmetic_tag = CRI_GER
				set_politics = {
					ruling_party = neutrality
					elections_allowed = no
				}
				set_popularities = {
					democratic = 21
					neutrality = 39
					fascism = 10
					communism = 30
				}
				set_party_name = {
					ideology = neutrality
					long_name = CRI_regional_government
					name = CRI_regional_government
				}
				every_possible_country = {
					limit = {
						has_character = RUS_matvei_sulkevich
					}
					RUS_matvei_sulkevich = {
						set_character_name = CRI_maciej_sulkiewicz
						set_nationality = CRI
					}
				}
				if = {
					limit = {
						has_character = RUS_matvei_sulkevich
					}
					RUS_matvei_sulkevich = {
						add_country_leader_role = {
							country_leader = {
								ideology = authoritarian_democracy
							}
						}
						promote_character = authoritarian_democracy
					}
				}
			}
		}
		ai_chance = { factor = 10 }
	}
	option = {
		name = ww1_crimea.3.b
		UKR = {
			annex_country = {
				target = CRI
			}
			hidden_effect = {
				if = {
					limit = {
						NOT = { owns_state = 137 }
					}
					transfer_state = 137
				}
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
	}
	option = {
		name = ww1_crimea.3.c
		trigger = {
			TUR = {
				is_in_faction_with = ROOT
				has_capitulated = no
				137 = {
					OR = {
						is_claimed_by = PREV
						is_core_of = PREV
					}
				}
			}
		}
		TUR = {
			annex_country = {
				target = CRI
			}
			hidden_effect = {
				if = {
					limit = {
						NOT = { owns_state = 137 }
					}
					transfer_state = 137
				}
			}
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				is_historical_focus_on = yes
			}
		}
	}
	option = {
		name = ww1_crimea.3.d
		UKR = {
			add_popularity = {
				ideology = communism
				popularity = 0.05
			}
			add_stability = -0.02
			add_state_claim = 137
		}
		ai_chance = { factor = 0 }
	}
}
# Solomon Krym in Crimea
country_event = {
	id = ww1_crimea.4
	title = ww1_crimea.4.t
	desc = ww1_crimea.4.d
	picture = GFX_report_event_generic_parliament
	trigger = {
		tag = CRI
		has_country_leader = {
			character = RUS_matvei_sulkevich
		}
		is_subject = no
		OR = {
			has_war = yes
			has_idea = communist_influence
			communism > 0.20
		}
		any_other_country = {
			is_in_russian_civil_war = yes
		}
	}
	fire_only_once = yes
	mean_time_to_happen = { days = 60 }
	option = {
		name = event_generic_ok
		promote_character = CRI_solomon_krym
		hidden_effect = {
			RUS_matvei_sulkevich = {
				remove_country_leader_role = {
					ideology = authoritarian_democracy
				}
			}
		}
		RUS_matvei_sulkevich = {
			set_nationality = AZR
		}
		random_other_country = {
			limit = {
				NOT = {
					has_government = communism
				}
				has_war_with = SOV
				is_in_russian_civil_war = yes
			}
			ROOT = {
				add_to_war = {
					targeted_alliance = PREV
					enemy = SOV
				}
			}
		}
	}
}
